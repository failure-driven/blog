<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Failure Driven  | Is snapshot testing test driven?</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.51" />
    
    
    <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
    <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
    
    

    

    <meta property="og:title" content="Is snapshot testing test driven?" />
<meta property="og:description" content="In our endeavour to pair with everyone as part of &ldquo;The Rails Camp Project&rdquo;, at Rails Camp Hobart, our next pair was Emily." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://failure-driven.com/rails-camp/commit-06-is-snapshot-testing-test-driven/" />
<meta property="og:image" content="https://failure-driven.com/images/rails-camp/commit_06_emily_coats_74791c0fa7e_still.jpg" />

<meta property="og:image" content="https://failure-driven.com/images/failure-driven_square.jpg" />
<meta property="article:published_time" content="2019-01-31T08:00:00&#43;11:00"/>
<meta property="article:modified_time" content="2019-01-31T08:00:00&#43;11:00"/>

<meta itemprop="name" content="Is snapshot testing test driven?">
<meta itemprop="description" content="In our endeavour to pair with everyone as part of &ldquo;The Rails Camp Project&rdquo;, at Rails Camp Hobart, our next pair was Emily.">


<meta itemprop="datePublished" content="2019-01-31T08:00:00&#43;11:00" />
<meta itemprop="dateModified" content="2019-01-31T08:00:00&#43;11:00" />
<meta itemprop="wordCount" content="1096">

  <meta itemprop="image" content="https://failure-driven.com/images/rails-camp/commit_06_emily_coats_74791c0fa7e_still.jpg">

  <meta itemprop="image" content="https://failure-driven.com/images/failure-driven_square.jpg">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://failure-driven.com/images/rails-camp/commit_06_emily_coats_74791c0fa7e_still.jpg"/>

<meta name="twitter:title" content="Is snapshot testing test driven?"/>
<meta name="twitter:description" content="In our endeavour to pair with everyone as part of &ldquo;The Rails Camp Project&rdquo;, at Rails Camp Hobart, our next pair was Emily."/>

</head>

<body class="ma0 avenir bg-near-white">


   
  

  
  
  <header class="cover bg-top" style="background-image: url('http://s3-ap-southeast-2.amazonaws.com/failure-driven-blog/railscamp-24-woodfield-hobart/commit_06_emily_coats_74791c0fa7e.gif');">
    <div class="pb3-m pv7-l none">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://failure-driven.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      Failure Driven
    </a>
    <div class="flex-l items-center">
      
      



  <a href="https://twitter.com/selenasmall88" class="link-transition twitter link dib z-999 pt3 pt0-l mr2" title="Twitter link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

  </a>


  <a href="https://twitter.com/saramic" class="link-transition twitter link dib z-999 pt3 pt0-l mr2" title="Twitter link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

  </a>







    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Is snapshot testing test driven?</h1>
        
      </div>
    </div>
  </header>



<main role="main">
    
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        THE RAILS CAMP PROJECT
      </p>
      <h1 class="f1 athelas mb1">Is snapshot testing test driven?</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-01-31T08:00:00&#43;11:00">January 31, 2019</time>      
      
      
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p>In our endeavour to pair with everyone as part of <a href="https://failure-driven.com/post/railscamp-pairing/">&ldquo;The Rails Camp Project&rdquo;</a>, at Rails Camp Hobart, our next pair was
Emily. The aim of the project was to test drive a simple multi round game using
a Rails backend and ReactJS. Emily was the lucky one to write the first line of
actual code making the <a href="https://failure-driven.com/rails-camp/commit-04-and-05-first-line-of-code-in-rails-app/">test written by Matt Patterson</a> pass. The
only hurdle for us Rails developers was to navigate the always changing ReactJS
landscape and make use of snapshot testing, but how is snapshot testing even
test driven?</p>

<p>Now, we&rsquo;ve written an integration test that incorporates the backend logic as
well as the front end behaviour. You might be wondering if the test we wrote
with rspec is going to also cover the javascript and markup. Well, it is. But
we&rsquo;re also going to need to start adding some isolated unit tests for the
frontend at some point.</p>

<p>You see, integration tests test that all components work together as expected
but we also need to ensure that each isolated unit works on its own as expected
too.</p>

<p>First, we got Emily to help us setup <a href="https://airbnb.io/enzyme/">Enzyme</a>
testing and in a rush to try new things we added snapshot tests. As Enzyme
Snapshot tests were the cool new thing people talked about we presumed this
would be a good way to test the React component of our game. Emily changed the
app entry which we created in <a href="https://failure-driven.com/rails-camp/commit-02-create-react-app/">commit 02 create-react-app</a> to what was expected in our first
integration test, a H1 with &ldquo;Welcome to the game&rdquo;.</p>

<blockquote>
<p><strong>The below animation shows that with snapshot testing you update your
implementation to get a failure in the tests. This is the wrong way around
for test driven development. Snapshots are not test driven and should not be
used to drive out functionality but are ok for a verification of the general
structure and styling of a component if done together with a visual check in
the browser and a good set of integration tests.</strong></p>
</blockquote>

<p><img src="/images/rails-camp/commit_06_snapshot_testing.gif" alt="snapshot testing" /></p>

<p>At this time this was not really &ldquo;test driven&rdquo;. We wrote the implementation and
then just accepted what was provided by the Enzyme snapshot with a press of <code>u</code>
for update the snapshot. on various discussions in the past we have heard
eveything from:</p>

<blockquote>
<p>&ldquo;snapshot test everything, it is the new way of testing, we test 95% of our
app that way&rdquo;</p>
</blockquote>

<p>to</p>

<blockquote>
<p>&ldquo;well you could edit the snapshot to make it fail and then update the
implementation to make it pass&rdquo;</p>
</blockquote>

<p>So as we write this article a few months later what is our view on Enzyme and
snapshot testing?</p>

<h2 id="our-current-rules-on-enzyme-testing">Our current rules on Enzyme testing</h2>

<ul>
<li>use shallow rendering for most unit level assertions
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-react" data-lang="react"><span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#34;renders welcome message&#34;</span>, () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrapper</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">shallow</span>(&lt;<span style="color:#f92672">App</span> /&gt;);
  <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">wrapper</span>.<span style="color:#a6e22e">childAt</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">type</span>()).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#34;h1&#34;</span>);
  <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">wrapper</span>.<span style="color:#a6e22e">childAt</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">text</span>()).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#34;Welcome to the game&#34;</span>);
});</code></pre></div></li>
<li>use full DOM rendering sparingly, using <code>mount()</code> is no longer doing isolated
unit testing of componenets. It can be handy when testing components that
come from a third party and what goes on inside the component is not the
concern of our tests, like when we use react router in a few posts time.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-react" data-lang="react"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrapper</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mount</span>(
  &lt;<span style="color:#f92672">MemoryRouter</span>&gt;
    &lt;<span style="color:#f92672">App</span>/&gt;
  &lt;/<span style="color:#f92672">MemoryRouter</span>&gt;
);</code></pre></div></li>
<li>use snapshot testing as a once off for a component as more of a &ldquo;pseudo
visual&rdquo; confirmation that should be actually reviewed in the browser before
pressing <code>u</code> to update the snapshot, more of a CSS style test.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-react" data-lang="react"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrapper</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">shallow</span>(&lt;<span style="color:#f92672">App</span> /&gt;);
<span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">shallowToJson</span>(<span style="color:#a6e22e">wrapper</span>)).<span style="color:#a6e22e">toMatchSnapshot</span>();</code></pre></div></li>
<li>And don&rsquo;t get over excited like we did and attempt to use snapshot testing
for everything</li>
</ul>

<h1 id="tracking-to-pair-with-everyone-at-rails-camp">Tracking to pair with everyone at rails camp</h1>

<p>With a lot of work already cut out for us, trying to share context with 36
developers, one at a time in just 48 hours - many of whom are new to, or
unpracticed at TDD - we were thankful for our background in pair programming.</p>

<p>Our ability to navigate and pre-empt our new pairing budies as each new pair
approached the keyboard meant that <em>they</em> could get stuck in quicker.</p>

<p><img alt="@gamzatti" src="//github.com/gamzatti.png" style="display: inline; width: 88px;" height="88" />
<img alt="@SelenaSmall" src="//github.com/SelenaSmall.png" style="display: inline; width: 88px;" height="88" />
<img alt="@saramic" src="//github.com/saramic.png" style="display: inline; width: 88px;" height="88" /></p>

<p>Commit <a href="https://github.com/failure-driven/railscamp-search-term/commit/ea441c9dfecf4ce2e96d5534773642ce9e16e683">ea441c9</a></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Author: Emily Coats &lt;gamzatti@users.noreply.github.com&gt;
Date:   Sat Nov <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">17</span>:19:12 <span style="color:#ae81ff">2018</span> +1100

Add welcome message

Co-authored-by: Selena Small &lt;selenawiththetattoo@gmail.com&gt;
Co-authored-by: Michael Milewski &lt;saramic@gmail.com&gt;</code></pre></div>

<p>Emily is a <a href="https://vuejs.org/">vue.js</a> developer and this was her first
experience with snapshot testing. To be honest, we have only been playing with
it for a short while and are still debating as to how usefull it actually is.</p>

<p>The way it works is, the test takes a snapshot of the shallow rendered React
component under test. What this means is that only that component is rendered
and only the props that would be passed to further components down the render
tree are rendered and not the actual components. This means if an element
changes or state causes a change in the rendering of the component, then the
snapshot changes when test are run again. You can then verify the changes are
what you expected, post implementing the actual change, so not driving them
through the tests.</p>

<p>The problem, however, is that very quickly huge swaths of HTML like snapshots
are being generated which can become a nightmare as you try to find the diffs.
As you can imagine, developers who are in a rush or don&rsquo;t know any better, are
likely to just accept those changes without double checking.</p>

<h3 id="5-minutes-with-emily">5 minutes with Emily</h3>

<p><strong>Emily:</strong></p>

<blockquote>
<p>&ldquo;I see how useful this would be for refactoring to see you have not changed
anything by accident&rdquo;</p>
</blockquote>

<p>To test this thought, we put a simple outer div around a component and the
snapshot basically said the whole page had changed when in fact the div had
made the snapshot indent the identical content.</p>

<blockquote>
<p>&ldquo;It does seem a bit fiddly with minor changes causing big changes in
snapshots&rdquo;</p>
</blockquote>

<p>The rails camp pairing experience was a great way to get an overview of how
different people work, pair and test. We learned that Emily would usually write
a unit test frist, get the code to work and then write a feature test
afterwards.</p>

<p>Happy with the way our group pairing went, Emily liked the idea we presented of
layered tests.</p>

<h3 id="lolcommit">Lolcommit</h3>

<p><img src="https://s3-ap-southeast-2.amazonaws.com/failure-driven-blog/railscamp-24-woodfield-hobart/commit_06_emily_coats_74791c0fa7e.gif" alt="Add welcome message" /></p>

<h3 id="next-time">Next time</h3>

<p>Now that we have implemented a spec through the integration layer down to the
component unit testing layer and made it pass, it will be time to rinse and
repeat next time. Another failing test, but what if you cannot make it pass but
still want to integrate your code with the rest of the team and not break
continuous integration CI tests? join us next time to find out.</p>

<h4 id="authored-by">Authored By:</h4>

<p>Selena Small &amp; Michael Milewski</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </main>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

</main>
<footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://failure-driven.com/" >
    &copy; 2019 Selena Small &amp; Michael Milewski
  </a>
    <div>



  <a href="https://twitter.com/selenasmall88" class="link-transition twitter link dib z-999 pt3 pt0-l mr2" title="Twitter link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

  </a>


  <a href="https://twitter.com/saramic" class="link-transition twitter link dib z-999 pt3 pt0-l mr2" title="Twitter link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

  </a>






</div>
  </div>
</footer>



  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/custom.css"/>


</body>
</html>
